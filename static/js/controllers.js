// Generated by CoffeeScript 1.7.1
(function() {
  'use strict';
  angular.module('cocktail.controllers', []).controller('SearchCtrl', [
    '$scope', 'Ingredients', 'Recipes', function($scope, Ingredients, Recipes) {
      var getRecipeInfo, searchIngredients, searchRecipes;
      $scope.ingredients = [];
      $scope.currentRecipe = {};
      $scope.currentRecipe['active'] = false;
      $scope.addIngredient = function(ingredient) {
        $scope.ingredients.push(ingredient);
        $scope.ingredient = null;
        $scope.articles = [];
        return searchRecipes($scope.ingredients);
      };
      $scope.closeOverlay = function() {
        return $scope.currentRecipe['active'] = false;
      };
      $scope.getRecipe = function(recipe) {
        return getRecipeInfo(recipe[0]);
      };
      $scope.onChange = function() {
        if ($scope.ingredient === null || Â $scope.ingredient === void 0) {
          return;
        }
        if ($scope.ingredient.length > 1) {
          return searchIngredients($scope.ingredient);
        } else {
          return $scope.articles = [];
        }
      };
      $scope.removeIngredient = function(ingredient) {
        var index;
        index = $scope.ingredients.indexOf(ingredient);
        if (index > -1) {
          $scope.ingredients.splice(index, 1);
        }
        if ($scope.ingredients.length > 0) {
          return searchRecipes($scope.ingredients);
        } else {
          return $scope.recipes = null;
        }
      };
      getRecipeInfo = function(recipe) {
        return Recipes.getRecipeInfo(recipe, function(error, info) {
          $scope.currentRecipe['name'] = info['result']['name'];
          $scope.currentRecipe['description'] = info['result']['description'];
          $scope.currentRecipe['ingredients'] = info['result']['ingredients'];
          return $scope.currentRecipe['active'] = true;
        });
      };
      searchIngredients = function(searchString) {
        return Ingredients.search(searchString, function(error, ingredients) {
          return $scope.articles = ingredients;
        });
      };
      return searchRecipes = function(ingredients) {
        return Recipes.search(ingredients, function(error, recipes) {
          return $scope.recipes = recipes;
        });
      };
    }
  ]);

}).call(this);
